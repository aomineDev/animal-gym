<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
</head>

<body>
    <th:block th:fragment="content">
        <div class="container">

            <!-- gestion empleado + icono -->
            <div class="mb-4">
                <h2><i class="bi bi-people me-2"></i>Gestión de empleados</h2>
            </div>

            <!--Buscador + select rol + nuevo empleado-->
            <div class="row g-3 mb-5">

                <div class="col-md-4 col-12">
                    <input type="text" class="form-control" id="buscarEmpleadoPorNombre"
                        placeholder="Buscar por nombre">
                </div>

                <div class="col-md-4 col-12">
                    <select name="rol_id" class="form-select crearRol" required>
                        <option value="">Seleccione un rol...</option>
                        <option th:each="rol : ${contenedorRol}" th:value="${rol.rolId}" th:text="${rol.nombre}">
                        </option>
                    </select>
                </div>

                <div class="col-md-4 col-12">
                    <button type="submit" class="btn btn-primary w-100" data-bs-toggle="modal"
                        data-bs-target="#modalAñadirEmpleado">
                        <i class="bi bi-person-plus me-2"></i>Nuevo empleado
                    </button>
                </div>

            </div>

            <!-- Tabla de los empleados-->
            <div class="table-responsive mt-4">
                <table class="table table-hover align-middle">
                    <!-- cabezeras de la tabla -->
                    <thead class="table-light">
                        <tr class="text-center">
                            <th>Foto</th>
                            <th>Dni</th>
                            <th>Nombre</th>
                            <th>Apellido</th>
                            <th>Telefono</th>
                            <th>Genero</th>
                            <th>Email</th>
                            <th>Fecha de nacimiento</th>
                            <th>Fecha de ingreso</th>
                            <th>Salario</th>
                            <th>Tipo contrato</th>
                            <th>Especialidad</th>
                            <th>Rol del usuario</th>
                        </tr>
                    </thead>
                    <!-- contenido de la tabla -->
                    <!-- th:each="empleado: ${empleadoTabla}" -->
                    <tbody id="tablaEmpleados" class="text-center">
                        <tr th:each="usuario : ${contenedorUser}">
                            <td><img th:src="@{${usuario.persona.foto}}" class="profile-img" alt="Foto del empleado">
                            </td>
                            <td th:text="${usuario.persona.dni}"></td>
                            <td th:text="${usuario.persona.nombre}"></td>
                            <td th:text="${usuario.persona.apellido}"></td>
                            <td th:text="${usuario.persona.telefono}"></td>
                            <td th:text="${usuario.persona.genero}"></td>
                            <td th:text="${usuario.persona.email}"></td>
                            <td th:text="${usuario.persona.fechaNacimiento}"></td>
                            <td th:text="${usuario.persona.fechaIngreso}"></td>
                            <td th:text="${usuario.persona.salario}"></td>
                            <td th:text="${usuario.persona.tipoContrato}"></td>
                            <td th:text="${usuario.persona.especialidad}"></td>
                            <td th:text="${usuario.rol.nombre}"></td>
                            <td>
                                <div class="dropdown">
                                    <button class="btn btn-link text-dark p-0" type="button" data-bs-toggle="dropdown">
                                        <i class="bi bi-three-dots-vertical"></i>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <a class="dropdown-item" href="#" data-bs-toggle="modal" data-id="${id}"
                                                th:attr="data-bs-target=|#editar__${usuario.persona.personaId}|">

                                                <i class="bi bi-pencil me-2"></i>Editar</a>
                                        </li>
                                        <li>
                                            <hr class="dropdown-divider">
                                        </li>
                                        <li>
                                            <!-- //añadir id para eliminar -->
                                            <a class="dropdown-item text-danger" data-bs-toggle="modal"
                                                th:attr="data-bs-target=|#eliminar__${usuario.persona.personaId}|"
                                                href="#" data-id="${id}">
                                                <i class="bi bi-trash me-2"></i>Eliminar</a>
                                        </li>
                                    </ul>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <!-- paginacion -->
                <div class="mt-4">
                    <nav aria-label="Paginación de empleados">
                        <ul class="pagination justify-content-center">
                            <li class="page-item disabled">
                                <a class="page-link" href="#" tabindex="-1">Anterior</a>
                            </li>
                            <li class="page-item active">
                                <a class="page-link" href="#">1</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="#">2</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="#">3</a>
                            </li>
                            <li class="page-item">
                                <span class="page-link">...</span>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="#">5</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="#">Siguiente</a>
                            </li>
                        </ul>
                    </nav>
                </div>

            </div>
        </div>

    </th:block>
    <th:block th:fragment="modals">
        <!-- verDetalles de boleta -->
        <!-- <div th:replace="empleados :: modalAñadirEmpleado"></div> -->
        <div th:replace="empleados :: modalAñadirEmpleado"></div>
        <div th:replace="empleados :: modalEliminarEmpleado"></div>
        <div th:replace="empleados :: modalActualizarEmpleado"></div>
    </th:block>
    <!-- modal añadir empleado -->
    <th:block th:fragment="modalAñadirEmpleado">
        <div class="modal fade" tabindex="-1" id="modalAñadirEmpleado">
            <div class="modal-dialog modal-dialog-centered modal-lg" id="modal-hijo">
                <div class="modal-content rounded-4">
                    <div class="modal-header">
                        <h5 class="modal-title text-center w-100">Agregar Empleado</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                            id="close"></button>
                    </div>
                    <div class="modal-body">
                        <!-- formulario del modal -->
                        <form id="formEmpleado" class="needs-validation" novalidate method="post">

                            <!-- Sección Datos Personales -->
                            <div class="form-section mb-4">
                                <h6 class="section-title text-primary border-bottom pb-2 mb-3"> Datos Personales</h6>
                                <div class="row g-3">
                                    <!-- dni -->
                                    <div class="col-md-6">
                                        <label for="dni" class="form-label">DNI *</label>
                                        <input type="text" id="dni" class="form-control" name="dni" pattern="[0-9]{8}"
                                            maxlength="8" required />

                                    </div>

                                    <!-- file -->
                                    <div class="col-md-6">
                                        <label for="file" class="form-label">Foto del empleado</label>
                                        <input type="file" id="file" class="form-control" name="file"
                                            accept="image/jpeg,image/jpg,image/png" required>
                                    </div>

                                    <!-- nombre -->
                                    <div class="col-md-6">
                                        <label for="nombre" class="form-label">Nombre *</label>
                                        <input type="text" id="nombre" name="nombre" class="form-control"
                                            pattern="[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+" required />
                                    </div>

                                    <!-- apellido -->
                                    <div class="col-md-6">
                                        <label for="apellido" class="form-label">Apellido *</label>
                                        <input type="text" id="apellido" name="apellido" class="form-control"
                                            pattern="[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+" required />

                                    </div>

                                    <!-- telefono -->
                                    <div class="col-md-4">
                                        <label for="telefono" class="form-label">Teléfono</label>
                                        <input type="tel" id="telefono" class="form-control" name="telefono"
                                            pattern="9[0-9]{8}" placeholder="9XXXXXXXX" required />
                                    </div>

                                    <!-- genero -->
                                    <div class="col-md-4">
                                        <label for="genero" class="form-label">Género</label>
                                        <select id="genero" class="form-select" name="genero" required>
                                            <option value="">Seleccionar...</option>
                                            <option value="Masculino">Masculino</option>
                                            <option value="Femenino">Femenino</option>
                                        </select>
                                    </div>

                                    <!-- email -->
                                    <div class="col-md-4">
                                        <label for="email" class="form-label">Correo electrónico *</label>
                                        <input type="email" id="email" class="form-control" name="email"
                                            pattern="[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,}" required />
                                    </div>

                                    <!-- fecha de nacimiento -->
                                    <div class="col-md-6">
                                        <label for="fechaNacimiento" class="form-label">Fecha de nacimiento</label>
                                        <input type="date" id="fechaNacimiento" class="form-control"
                                            name="fechaNacimiento" / required>
                                    </div>

                                    <!-- Fecha de ingreso -->
                                    <div class="col-md-6">
                                        <label for="fechaIngreso" class="form-label">Fecha de ingreso</label>
                                        <input type="date" id="fechaIngreso" class="form-control" name="fechaIngreso"
                                            required />
                                    </div>
                                </div>
                            </div>

                            <!-- Sección Datos Laborales -->
                            <div class="form-section mb-4">
                                <h6 class="section-title text-primary border-bottom pb-2 mb-3">Datos Laborales</h6>
                                <div class="row g-3">
                                    <!-- salario -->
                                    <div class="col-md-4">
                                        <label for="salario" class="form-label">Salario *</label>
                                        <input type="number" id="salario" class="form-control" name="salario"
                                            step="0.01" min="0" required />
                                    </div>

                                    <!-- Tipo de contrato -->
                                    <div class="col-md-4">
                                        <label for="tipoContrato" class="form-label">Tipo de contrato</label>
                                        <select id="tipoContrato" class="form-select" name="tipoContrato" required>
                                            <option value="">Seleccionar...</option>
                                            <option value="Anual">Indefinido</option>
                                            <option value="Temporal">Temporal</option>
                                        </select>
                                    </div>

                                    <!-- especialidad -->
                                    <div class="col-md-4">
                                        <label for="especialidad" class="form-label">Especialidad</label>
                                        <input type="text" id="especialidad" class="form-control" name="especialidad"
                                            required />
                                    </div>
                                </div>
                            </div>

                            <!-- Sección Datos de Usuario -->
                            <div class="form-section mb-4">
                                <h6 class="section-title text-primary border-bottom pb-2 mb-3">Datos de Usuario</h6>

                                <!-- Nota informativa -->
                                <div class="alert alert-info py-2 mb-3">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Nota:</strong> El nombre de usuario será automáticamente el DNI ingresado.
                                </div>

                                <div class="row g-3">
                                    <!-- Usuario display -->
                                    <div class="col-md-6">
                                        <label for="usernameDisplay" class="form-label">Nombre de Usuario</label>
                                        <input type="text" class="form-control" id="usernameDisplay" readonly
                                            placeholder="Se generará con el DNI" style="background-color: #f8f9fa;">
                                        <div class="form-text">Este será el nombre para iniciar sesión (basado en el
                                            DNI)</div>
                                    </div>

                                    <!-- Rol -->
                                    <div class="col-md-6">
                                        <label for="rol_id" class="form-label">Rol *</label>
                                        <select name="rol_id" id="rol_id" class="form-select crearRol" required>
                                            <option value="">Seleccione un rol...</option>
                                            <option th:each="rol : ${contenedorRol}" th:value="${rol.rolId}"
                                                th:text="${rol.nombre}">
                                            </option>
                                        </select>

                                    </div>

                                    <!-- contraseña -->
                                    <div class="col-md-6">
                                        <label for="contraseña" class="form-label">Contraseña *</label>
                                        <input type="password" id="contraseña" class="form-control" name="contraseña"
                                            minlength="6" required />
                                        <div class="form-text">Mínimo 6 caracteres</div>

                                    </div>

                                    <!-- confirmar contraseña -->
                                    <div class="col-md-6">
                                        <label for="confirmarContraseña" class="form-label">Confirmar Contraseña
                                            *</label>
                                        <input type="password" id="confirmarContraseña" class="form-control"
                                            name="confirmarContraseña" minlength="6" required />
                                        <div id="passwordMessage" class="form-text"></div>
                                        <div class="invalid-feedback">
                                            Las contraseñas no coinciden
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                    Cerrar
                                </button>
                                </button>
                                <button type="submit" class="btn btn-primary" id="guardarEmpleado">
                                    Guardar Empleado
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </th:block>

    <!-- modal eliminar -->
    <th:block th:fragment="modalEliminarEmpleado">
        <div th:each="usuario: ${contenedorUser}">
            <div class="modal fade" th:id="|eliminar__${usuario.persona.personaId}|" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <!-- Header -->
                        <div class="modal-header">
                            <h5 class="modal-title">Confirmar Eliminación</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>

                        <!-- Body -->
                        <div class="modal-body">
                            <div class="text-center">
                                <i class="bi bi-exclamation-triangle text-warning" style="font-size: 3rem"></i>
                                <h6 class="mt-3">
                                    ¿Está seguro de que desea eliminar empleado <p th:text="${usuario.persona.nombre}">
                                    </p>
                                </h6>
                                <p class="text-muted">
                                    Esta acción no se puede deshacer.
                                </p>
                            </div>
                        </div>

                        <!-- Footer -->
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                Cancelar
                            </button>
                            <button type="button" class="btn btn-danger" id="btnConfirmarEliminar" data-id="">
                                <i class="bi bi-trash me-2"></i>Eliminar
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </th:block>
    <!-- modal actualizar empleado -->
    <th:block th:fragment="modalActualizarEmpleado">
        <div th:each="usuario: ${contenedorUser}">
            <div class="modal fade" th:id="|editar__${usuario.persona.personaId}|" tabindex="-1" aria-hidden="true">

                <div class="modal-dialog modal-dialog-centered modal-lg" id="modal-hijo">
                    <div class="modal-content rounded-4">
                        <div class="modal-header">
                            <h5 class="modal-title text-center w-100">Actualizar Empleado</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                                id="close"></button>
                        </div>
                        <div class="modal-body">
                            <!-- formulario del modal -->
                            <form id="formEmpleado" class="needs-validation" novalidate method="post">

                                <!-- Sección Datos Personales -->
                                <div class="form-section mb-4">
                                    <h6 class="section-title text-primary border-bottom pb-2 mb-3"> Datos Personales
                                    </h6>
                                    <div class="row g-3">
                                        <!-- dni -->
                                        <div class="col-md-6">
                                            <label for="dni" class="form-label">DNI *</label>
                                            <input type="text" id="dni" class="form-control" name="dni"
                                                pattern="[0-9]{8}" maxlength="8" th:value="${usuario.persona.dni}"
                                                required />

                                        </div>
                                        <div class="col-md-6">
                                            <label for="file" class="form-label">Foto del empleado</label>
                                            <input type="file" id="file" class="form-control" name="file"
                                                accept="image/jpeg,image/jpg,image/png" required>
                                        </div>

                                        <!-- nombre -->
                                        <div class="col-md-6">
                                            <label for="nombre" class="form-label">Nombre *</label>
                                            <input type="text" id="nombre" name="nombre" class="form-control"
                                                pattern="[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+" th:value="${usuario.persona.nombre}"
                                                required />
                                        </div>

                                        <!-- apellido -->
                                        <div class="col-md-6">
                                            <label for="apellido" class="form-label">Apellido *</label>
                                            <input type="text" id="apellido" name="apellido" class="form-control"
                                                pattern="[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+" th:value="${usuario.persona.apellido}"
                                                required />

                                        </div>

                                        <!-- telefono -->
                                        <div class="col-md-4">
                                            <label for="telefono" class="form-label">Teléfono</label>
                                            <input type="tel" id="telefono" class="form-control" name="telefono"
                                                pattern="9[0-9]{8}" placeholder="9XXXXXXXX"
                                                th:value="${usuario.persona.telefono}" required />
                                        </div>

                                        <!-- genero -->
                                        <div class="col-md-4">
                                            <label for="genero" class="form-label">Género</label>
                                            <select id="genero" class="form-select" name="genero" required>
                                                <option value="">Seleccionar...</option>
                                                <option value="Masculino"
                                                    th:selected="${usuario.persona.genero == 'Masculino'}">
                                                    Masculino</option>
                                                <option value="Indefinido"
                                                    th:selected="${usuario.persona.genero == 'Femenino'}">
                                                    Femenino</option>
                                            </select>
                                        </div>

                                        <!-- email -->
                                        <div class="col-md-4">
                                            <label for="email" class="form-label">Correo electrónico *</label>
                                            <input type="email" id="email" class="form-control" name="email"
                                                pattern="[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,}"
                                                th:value="${usuario.persona.email}" required />
                                        </div>

                                        <!-- fecha de nacimiento -->
                                        <div class="col-md-6">
                                            <label for="fechaNacimiento" class="form-label">Fecha de nacimiento</label>
                                            <input type="date" id="fechaNacimiento" class="form-control"
                                                name="fechaNacimiento" th:value="${usuario.persona.fechaNacimiento}"
                                                required />
                                        </div>

                                        <!-- Fecha de ingreso -->
                                        <div class="col-md-6">
                                            <label for="fechaIngreso" class="form-label">Fecha de ingreso</label>
                                            <input type="date" id="fechaIngreso" class="form-control"
                                                name="fechaIngreso" th:value="${usuario.persona.fechaIngreso}"
                                                required />
                                        </div>
                                    </div>
                                </div>

                                <!-- Sección Datos Laborales -->
                                <div class="form-section mb-4">
                                    <h6 class="section-title text-primary border-bottom pb-2 mb-3">Datos Laborales</h6>
                                    <div class="row g-3">
                                        <!-- salario -->
                                        <div class="col-md-4">
                                            <label for="salario" class="form-label">Salario *</label>
                                            <input type="number" id="salario" class="form-control" name="salario"
                                                step="1" min="0" th:value="${usuario.persona.salario}" required />
                                        </div>

                                        <!-- Tipo de contrato -->
                                        <div class="col-md-4">
                                            <label for="tipoContrato" class="form-label">Tipo de contrato</label>
                                            <select id="tipoContrato" class="form-select" name="tipoContrato" required>
                                                <option value="">Seleccione...</option>
                                                <option value="Anual"
                                                    th:selected="${usuario.persona.tipoContrato == 'Anual'}">
                                                    Anual</option>

                                                <option value="Indefinido"
                                                    th:selected="${usuario.persona.tipoContrato == 'Indefinido'}">
                                                    Indefinido</option>
                                            </select>
                                        </div>

                                        <!-- especialidad -->
                                        <div class="col-md-4">
                                            <label for="especialidad" class="form-label">Especialidad</label>
                                            <input type="text" id="especialidad" class="form-control"
                                                name="especialidad" th:value="${usuario.persona.especialidad}"
                                                required />
                                        </div>
                                    </div>
                                </div>

                                <!-- Sección Datos de Usuario -->
                                <div class="form-section mb-4">
                                    <h6 class="section-title text-primary border-bottom pb-2 mb-3">Datos de Usuario</h6>

                                    <!-- Nota informativa -->
                                    <div class="alert alert-info py-2 mb-3">
                                        <i class="fas fa-info-circle me-2"></i>
                                        <strong>Nota:</strong> El nombre de usuario será automáticamente el DNI
                                        ingresado.
                                    </div>

                                    <div class="row g-3">
                                        <!-- Usuario display -->
                                        <div class="col-md-6">
                                            <label for="usernameDisplay" class="form-label">Nombre de Usuario</label>
                                            <input type="text" class="form-control" id="usernameDisplay" readonly
                                                placeholder="Se generará con el DNI" style="background-color: #f8f9fa;"
                                                th:value="${usuario.persona.dni}">
                                            <div class="form-text">Este será el nombre para iniciar sesión (basado en el
                                                DNI)</div>
                                        </div>

                                        <!-- Rol -->
                                        <div class="col-md-6">
                                            <label for="rol_id" class="form-label">Rol *</label>
                                            <select name="rol_id" id="rol_id" class="form-select crearRol" required>
                                                <option value="">Seleccione un rol...</option>
                                                <option value="Indefinido"
                                                    th:selected="${usuario.rol.nombre == 'Cajero'}">
                                                    Cajero</option>
                                                <option value="Indefinido"
                                                    th:selected="${usuario.rol.nombre == 'Mesero'}">
                                                    Mesero</option>
                                            </select>

                                        </div>

                                        <!-- contraseña -->
                                        <div class="col-md-6">
                                            <label for="contraseña" class="form-label">Contraseña *</label>
                                            <input type="password" id="contraseña" class="form-control"
                                                name="contraseña" minlength="6" th:value="${usuario.contraseña}"
                                                required />
                                            <div class="form-text">Mínimo 6 caracteres</div>

                                        </div>

                                        <!-- confirmar contraseña -->
                                        <div class="col-md-6">
                                            <label for="confirmarContraseña" class="form-label">Confirmar Contraseña
                                                *</label>
                                            <input type="password" id="confirmarContraseña" class="form-control"
                                                name="confirmarContraseña" minlength="6"
                                                th:value="${usuario.contraseña}" required />
                                            <div id="passwordMessage" class="form-text"></div>

                                        </div>
                                    </div>
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                        Cerrar
                                    </button>
                                    </button>
                                    <button type="submit" class="btn btn-primary" id="guardarEmpleado">
                                        Guardar Empleado
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

    </th:block>


</body>

</html>